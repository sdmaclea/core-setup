From eb0e5a9ffd2c3d3c3420b5f628958b55b9b42bdb Mon Sep 17 00:00:00 2001
From: Steve MacLean <sdmaclea.qdt@qualcommdatacenter.com>
Date: Fri, 20 Oct 2017 16:30:22 -0400
Subject: [PATCH] [Arm64] Enable SIMD compilation

---
 src/jit/CMakeLists.txt             | 5 +++++
 src/jit/protononjit/CMakeLists.txt | 3 +--
 2 files changed, 6 insertions(+), 2 deletions(-)

diff --git a/src/jit/CMakeLists.txt b/src/jit/CMakeLists.txt
index 32c6065..a18107d 100644
--- a/src/jit/CMakeLists.txt
+++ b/src/jit/CMakeLists.txt
@@ -9,6 +9,10 @@ if (CLR_CMAKE_TARGET_ARCH_AMD64 OR (CLR_CMAKE_TARGET_ARCH_I386 AND NOT CLR_CMAKE
   add_definitions(-DFEATURE_HW_INTRINSICS)
 endif ()
 
+if (CLR_CMAKE_TARGET_ARCH_ARM64)
+  add_definitions(-DFEATURE_SIMD)
+endif ()
+
 # JIT_BUILD disables certain PAL_TRY debugging features
 add_definitions(-DJIT_BUILD=1)
 
@@ -141,6 +145,7 @@ set( JIT_ARM64_SOURCES
   lowerarm64.cpp
   lsraarmarch.cpp
   lsraarm64.cpp
+  simd.cpp
   targetarm64.cpp
   unwindarm.cpp
   unwindarm64.cpp
diff --git a/src/jit/protononjit/CMakeLists.txt b/src/jit/protononjit/CMakeLists.txt
index 33916c3..1d82086 100644
--- a/src/jit/protononjit/CMakeLists.txt
+++ b/src/jit/protononjit/CMakeLists.txt
@@ -5,8 +5,6 @@ add_definitions(-DFEATURE_NO_HOST)
 add_definitions(-DSELF_NO_HOST)
 remove_definitions(-DFEATURE_MERGE_JIT_AND_ENGINE)
 
-remove_definitions(-DFEATURE_SIMD)
-
 remove_definitions(-DFEATURE_HW_INTRINSICS)
 
 if(FEATURE_READYTORUN)
@@ -15,6 +13,7 @@ endif(FEATURE_READYTORUN)
 
 if (CLR_CMAKE_PLATFORM_ARCH_I386)
     remove_definitions(-D_TARGET_X86_=1)
+    remove_definitions(-DFEATURE_SIMD)
     add_definitions(-D_TARGET_ARM_)
     set(JIT_ARCH_ALTJIT_SOURCES ${JIT_ARM_SOURCES})
     set(JIT_ARCH_LINK_LIBRARIES gcinfo_arm)
-- 
2.7.4

