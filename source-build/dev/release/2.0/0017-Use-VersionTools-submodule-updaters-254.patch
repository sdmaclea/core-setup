From 9719f3ebb29eae83477f6e93609af2622da08776 Mon Sep 17 00:00:00 2001
From: Davis Goodin <dagood@users.noreply.github.com>
Date: Tue, 21 Nov 2017 11:45:57 -0600
Subject: [PATCH] Use VersionTools submodule updaters (#254)

---
 .gitignore                                    |  7 +++
 .gitmodules                                   | 11 +++--
 build.proj                                    |  2 +-
 dir.props                                     |  1 +
 scripts/auto-update/build.proj                |  6 ---
 scripts/auto-update/dependencies.props        | 61 ---------------------------
 scripts/auto-update/dir.props                 | 12 ------
 scripts/auto-update/update-submodules.targets | 23 ----------
 8 files changed, 17 insertions(+), 106 deletions(-)
 delete mode 100644 scripts/auto-update/build.proj
 delete mode 100644 scripts/auto-update/dependencies.props
 delete mode 100644 scripts/auto-update/dir.props
 delete mode 100644 scripts/auto-update/update-submodules.targets

diff --git a/.gitignore b/.gitignore
index a7727b9..f9421ea 100644
--- a/.gitignore
+++ b/.gitignore
@@ -268,4 +268,11 @@ Session.vim
 config.ps1
 **/IISApplications
 
+### source-build ###
 prebuilt/
+msbuild.binlog
+
+# Exists temporarily during build. Interferes with VersionTools'
+# UpdateDependenciesAndSubmitPullRequest: if no upgrades are performed, the
+# sanity check fails when "git status" shows this file.
+msbuild.ProjectImports.zip
diff --git a/.gitmodules b/.gitmodules
index 23a59d7..7416c68 100644
--- a/.gitmodules
+++ b/.gitmodules
@@ -1,18 +1,21 @@
 [submodule "src/coreclr"]
 	path = src/coreclr
 	url = https://github.com/dotnet/coreclr
+	branch = release/2.0.0
 [submodule "src/roslyn"]
 	path = src/roslyn
 	url = https://github.com/dotnet/roslyn
 [submodule "src/core-setup"]
 	path = src/core-setup
 	url = https://github.com/dotnet/core-setup
+	branch = release/2.0.0
 [submodule "src/standard"]
 	path = src/standard
 	url = https://github.com/dotnet/standard
+	branch = release/2.0.0
 [submodule "src/cli"]
 	path = src/cli
-	url = https://www.github.com/dotnet/cli
+	url = https://github.com/dotnet/cli
 [submodule "src/nuget-client"]
 	path = src/nuget-client
 	url = https://github.com/NuGet/NuGet.Client
@@ -42,7 +45,8 @@
 	url = https://github.com/dotnet/cli-migrate
 [submodule "src/corefx"]
 	path = src/corefx
-	url = https://www.github.com/dotnet/corefx
+	url = https://github.com/dotnet/corefx
+	branch = release/2.0.0
 [submodule "src/fsharp"]
 	path = src/fsharp
 	url = https://github.com/Microsoft/VisualFSharp
@@ -64,5 +68,6 @@
 	branch = servicing/1.0.x
 [submodule "src/sdk"]
 	path = src/sdk
-	url = https://github.com/dotnet/sdk.git
+	url = https://github.com/dotnet/sdk
 	branch = release/2.0.0
+	versionToolsAutoUpdate = false
diff --git a/build.proj b/build.proj
index eb2ab46..edf1afa 100644
--- a/build.proj
+++ b/build.proj
@@ -26,6 +26,6 @@
     <RemoveDir Directories="$(BaseOutputPath)" />
   </Target>
 
-  <Import Project="$(MSBuildThisfileDirectory)scripts/auto-update/update-submodules.targets" />
+  <Import Project="$(ToolsDir)VersionTools.targets" />
 
 </Project>
diff --git a/dir.props b/dir.props
index 03c3f63..a9a0795 100644
--- a/dir.props
+++ b/dir.props
@@ -30,6 +30,7 @@
 
   <PropertyGroup>
     <SubmoduleDirectory Condition="'$(SubmoduleDirectory)' == ''">$(ProjectDir)src/</SubmoduleDirectory>
+    <GitModulesPath>$(ProjectDir).gitmodules</GitModulesPath>
   </PropertyGroup>
 
   <PropertyGroup>
diff --git a/scripts/auto-update/build.proj b/scripts/auto-update/build.proj
deleted file mode 100644
index 26d9cf2..0000000
diff --git a/scripts/auto-update/dependencies.props b/scripts/auto-update/dependencies.props
deleted file mode 100644
index a6456ae..0000000
diff --git a/scripts/auto-update/dir.props b/scripts/auto-update/dir.props
deleted file mode 100644
index 4e689d2..0000000
diff --git a/scripts/auto-update/update-submodules.targets b/scripts/auto-update/update-submodules.targets
deleted file mode 100644
index 4832775..0000000
-- 
2.7.4

