From 25a3d1a24c00d2920638f9fc91864c36fe27aaa3 Mon Sep 17 00:00:00 2001
From: Dan Seefeldt <Dan.Seefeldt@microsoft.com>
Date: Tue, 13 Feb 2018 14:05:10 -0600
Subject: [PATCH] Update PlatformApis.cs - Update based on CR comments (#326)

* Update based on CR comments

* Change relative path to use SubmoduleDirectory instead.

* Pass SubmoduleDirectory directly rather than from dir.props

* Update to get submoduleDirectory from dir.props

* TasksBinDir changed based on dir.props change.  Updating it to be correct.

* Update OutputPath to place tasks dll back where it was.
---
 .../Microsoft.DotNet.SourceBuild.Tasks.csproj         | 19 +++++++++++++------
 1 file changed, 13 insertions(+), 6 deletions(-)

diff --git a/tools-local/tasks/Microsoft.DotNet.SourceBuild.Tasks/Microsoft.DotNet.SourceBuild.Tasks.csproj b/tools-local/tasks/Microsoft.DotNet.SourceBuild.Tasks/Microsoft.DotNet.SourceBuild.Tasks.csproj
index f5ab1fa..0421db3 100755
--- a/tools-local/tasks/Microsoft.DotNet.SourceBuild.Tasks/Microsoft.DotNet.SourceBuild.Tasks.csproj
+++ b/tools-local/tasks/Microsoft.DotNet.SourceBuild.Tasks/Microsoft.DotNet.SourceBuild.Tasks.csproj
@@ -1,16 +1,23 @@
 ï»¿<Project Sdk="Microsoft.NET.Sdk">
   <PropertyGroup>
+    <!-- We use dotnet-cli to build BuildTasks, so we need to disable BuildTools Roslyn properties. -->
+    <DisableBuildToolsRoslynVersion>true</DisableBuildToolsRoslynVersion>
+  </PropertyGroup>
+  <Import Project="$([MSBuild]::GetDirectoryNameOfFileAbove($(MSBuildThisFileDirectory), dir.props))/dir.props" />
+  <PropertyGroup>
     <TargetFramework>netstandard1.5</TargetFramework>
     <AllowUnsafeBlocks>true</AllowUnsafeBlocks>
+    <CoreSetupPlatformAbstractionsPath>$(SubmoduleDirectory)core-setup/src/managed/Microsoft.DotNet.PlatformAbstractions/</CoreSetupPlatformAbstractionsPath>
+    <OutputPath>$(MSBuildThisFileDirectory)bin/$(Configuration)</OutputPath>
   </PropertyGroup>
 
   <ItemGroup>
-    <Compile Include="../../../src/core-setup/src/managed/Microsoft.DotNet.PlatformAbstractions/Platform.cs" />
-    <Compile Include="../../../src/core-setup/src/managed/Microsoft.DotNet.PlatformAbstractions/RuntimeEnvironment.cs" />
-    <Compile Include="../../../src/core-setup/src/managed/Microsoft.DotNet.PlatformAbstractions/Native/NativeMethods.Darwin.cs" />
-    <Compile Include="../../../src/core-setup/src/managed/Microsoft.DotNet.PlatformAbstractions/Native/NativeMethods.Unix.cs" />
-    <Compile Include="../../../src/core-setup/src/managed/Microsoft.DotNet.PlatformAbstractions/Native/NativeMethods.Windows.cs" />
-    <Compile Include="../../../src/core-setup/src/managed/Microsoft.DotNet.PlatformAbstractions/Native/PlatformApis.cs" />
+    <Compile Include="$(CoreSetupPlatformAbstractionsPath)Platform.cs" />
+    <Compile Include="$(CoreSetupPlatformAbstractionsPath)RuntimeEnvironment.cs" />
+    <Compile Include="$(CoreSetupPlatformAbstractionsPath)Native/NativeMethods.Darwin.cs" />
+    <Compile Include="$(CoreSetupPlatformAbstractionsPath)Native/NativeMethods.Unix.cs" />
+    <Compile Include="$(CoreSetupPlatformAbstractionsPath)Native/NativeMethods.Windows.cs" />
+    <Compile Include="$(CoreSetupPlatformAbstractionsPath)Native/PlatformApis.cs" />
   </ItemGroup>
 
   <ItemGroup>
-- 
2.7.4

