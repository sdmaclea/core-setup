From c761530289f45d79dc38f517b017c90911fa9f7a Mon Sep 17 00:00:00 2001
From: Nate McMaster <nate.mcmaster@microsoft.com>
Date: Wed, 25 Oct 2017 10:59:42 -0700
Subject: [PATCH] Remove patches for aspnet/common and update src/common to the
 repo-api implementation

---
 .gitmodules                                        |   1 +
 ...un-dotnet-migrate-on-M.E.CommandLineUtils.patch | 130 ---------------------
 .../common/0002-Only-Build-for-netstandard.patch   |  41 -------
 repos/common.proj                                  |  17 ++-
 src/common                                         |   2 +-
 5 files changed, 9 insertions(+), 182 deletions(-)
 delete mode 100644 patches/common/0001-Run-dotnet-migrate-on-M.E.CommandLineUtils.patch
 delete mode 100644 patches/common/0002-Only-Build-for-netstandard.patch

diff --git a/.gitmodules b/.gitmodules
index 26cb600..23a59d7 100644
--- a/.gitmodules
+++ b/.gitmodules
@@ -61,6 +61,7 @@
 [submodule "src/common"]
 	path = src/common
 	url = https://github.com/aspnet/common
+	branch = servicing/1.0.x
 [submodule "src/sdk"]
 	path = src/sdk
 	url = https://github.com/dotnet/sdk.git
diff --git a/patches/common/0001-Run-dotnet-migrate-on-M.E.CommandLineUtils.patch b/patches/common/0001-Run-dotnet-migrate-on-M.E.CommandLineUtils.patch
deleted file mode 100644
index 844e49f..0000000
diff --git a/patches/common/0002-Only-Build-for-netstandard.patch b/patches/common/0002-Only-Build-for-netstandard.patch
deleted file mode 100644
index a15a0e1..0000000
diff --git a/repos/common.proj b/repos/common.proj
index a90ba36..6c3f7f1 100644
--- a/repos/common.proj
+++ b/repos/common.proj
@@ -1,18 +1,15 @@
 <?xml version="1.0" encoding="utf-8"?>
 <Project ToolsVersion="15.0" xmlns="http://schemas.microsoft.com/developer/msbuild/2003">
   <Import Project="$([MSBuild]::GetDirectoryNameOfFileAbove($(MSBuildThisFileDirectory), dir.props))/dir.props" />
+
   <PropertyGroup>
-    <PackagesOutput>$(ProjectDirectory)src/Microsoft.Extensions.CommandLineUtils/bin/$(Configuration)/</PackagesOutput>
-    <RepoApiImplemented>false</RepoApiImplemented>
+    <RepositoryOrganization>aspnet</RepositoryOrganization>
+    <RepositoryBranch>servicing/1.0.x</RepositoryBranch>
+    <PackagesOutput>$(ProjectDirectory)artifacts/build/</PackagesOutput>
+    <BuildArguments>/p:Configuration=$(Configuration)</BuildArguments>
+    <BuildCommand>$(ProjectDirectory)/build$(ShellExtension) -NoTest $(BuildArguments)</BuildCommand>
+    <CleanCommand>$(ProjectDirectory)/clean$(ShellExtension) $(BuildArguments)</CleanCommand>
   </PropertyGroup>
 
   <Import Project="$([MSBuild]::GetDirectoryNameOfFileAbove($(MSBuildThisFileDirectory), dir.targets))/dir.targets" />
-
-  <Target Name="RepoBuild">
-    <Exec Command="$(DotnetToolCommand) restore $(ProjectDirectory)/src/Microsoft.Extensions.CommandLineUtils/Microsoft.Extensions.CommandLineUtils.csproj $(RedirectRepoOutputToLog)"
-          EnvironmentVariables="@(EnvironmentVariables)" />
-
-    <Exec Command="$(DotnetToolCommand) pack -c $(Configuration) $(ProjectDirectory)/src/Microsoft.Extensions.CommandLineUtils/Microsoft.Extensions.CommandLineUtils.csproj $(RedirectRepoOutputToLog)"
-          EnvironmentVariables="@(EnvironmentVariables)" />
-  </Target>
 </Project>
diff --git a/src/common b/src/common
index b12dfb6..be9aca0 160000
--- a/src/common
+++ b/src/common
@@ -1 +1 @@
-Subproject commit b12dfb606659f755b14777849256b014a07b25dd
+Subproject commit be9aca0f20c979498298be47e843e3a7b8777dca
-- 
2.7.4

